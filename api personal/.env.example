# ------------------------------------------------------------
# personalv5-enterprise-api - Example ENV (NO SECRETS)
# ------------------------------------------------------------

# runtime
NODE_ENV=development
PORT=3000
TRUST_PROXY=0

# core tables (vacío = default hardcodeado)
CORE_TABLES=

# ------------------------------------------------------------
# DB (dev / prod)
# ------------------------------------------------------------
DB_HOST=127.0.0.1
DB_PORT=3306
DB_NAME=personalv5
DB_USER=root
DB_PASSWORD=CHANGE_ME

# TEST DB (se usa si NODE_ENV=test y DB_HOST_TEST no está vacío)
DB_HOST_TEST=127.0.0.1
DB_PORT_TEST=3306
DB_NAME_TEST=personalv5_test
DB_USER_TEST=root
DB_PASSWORD_TEST=CHANGE_ME

# pool / timeouts
DB_POOL_MAX=10
DB_POOL_MIN=0
DB_POOL_ACQUIRE_MS=30000
DB_POOL_IDLE_MS=10000
DB_QUERY_TIMEOUT_MS=30000

# migrations / schema cache
MIGRATIONS_ENABLE=false
MIGRATIONS_DIR=scripts/migrations
SCHEMA_CACHE_PATH=./.cache/schema.json

# logging
LOG_DIR=./logs
LOG_LEVEL=info
LOG_RETENTION_DAYS=30

# ------------------------------------------------------------
# OpenAPI
# ------------------------------------------------------------
ENABLE_OPENAPI_VALIDATION=false
OPENAPI_PATH=docs/openapi.yaml
OPENAPI_AUTO_GENERATE=true
OPENAPI_AUTO_OUTPUT=docs/openapi.generated.yaml

# ------------------------------------------------------------
# hardening
# ------------------------------------------------------------
ENABLE_HARDENING=true
ENABLE_COMPRESSION=true
ENABLE_REQUEST_BODY_LIMITS=true
ENABLE_REQUEST_BODY_LIMITS=false

# CORS
CORS_ALLOW_ALL=false
CORS_ALLOWLIST=
CORS_DENYLIST=

# IP Guard
IP_GUARD_ENABLE=false
IP_ALLOWLIST=
IP_BLACKLIST=

# Docs
DOCS_ENABLE=true
DOCS_PATH=/docs
DOCS_PROTECT=true

# Rate limit
RATE_LIMIT_ENABLE=true
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX=300
RATE_LIMIT_BY_USER=false

RATE_LIMIT_USE_REDIS=false
CACHE_USE_REDIS=false         # Redis para cache de endpoints (independiente del rate limit)
REDIS_URL=redis://localhost:6379
REDIS_CONNECT_TIMEOUT_MS=5000

AUTH_RATE_LIMIT_WINDOW_MS=600000
AUTH_LOGIN_RATE_LIMIT_MAX=20
AUTH_REFRESH_RATE_LIMIT_MAX=60

# Metrics
METRICS_ENABLE=false
METRICS_PATH=/metrics
METRICS_PROTECT=false
METRICS_TOKEN=CHANGE_ME_LONG_RANDOM

# CRUD
CRUD_STRICT_ALLOWLIST=false
CRUD_TABLE_ALLOWLIST=
CRUD_TABLE_DENYLIST=
CRUD_READONLY=false

# Auth / RBAC
AUTH_ENABLE=true
RBAC_ENABLE=true
AUTH_ALLOW_DEV_USER_ID_HEADER=false  # activar solo en local/dev
AUTH_BEARER_MODE=auto

# JWT
JWT_ACCESS_SECRET=CHANGE_ME_LONG_RANDOM_AT_LEAST_32_CHARS
JWT_REFRESH_SECRET=CHANGE_ME_LONG_RANDOM_AT_LEAST_32_CHARS
JWT_ACCESS_TTL_SECONDS=3600
JWT_REFRESH_TTL_DAYS=7

# Email
EMAIL_ENABLE=false
EMAIL_HOST=
EMAIL_PORT=587
EMAIL_SECURE=false
EMAIL_USER=
EMAIL_PASSWORD=
EMAIL_FROM=

# Password reset
PASSWORD_RESET_TOKEN_TTL_HOURS=1
PASSWORD_RESET_URL_BASE=http://localhost:3000

# 2FA
ENABLE_2FA=false
TWO_FA_CODE_TTL_MINUTES=10
TWO_FA_CODE_LENGTH=6

# ------------------------------------------------------------
# Documents (REQUERIDO)
# ------------------------------------------------------------
DOCUMENTS_BASE_DIR=CHANGE_ME_PATH
PHOTOS_BASE_DIR=

DOCUMENTS_ALLOWED_MIME=application/pdf,image/jpeg,image/png,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
DOCUMENTS_MAX_BYTES=26214400

DOCUMENTS_SCAN_ENABLE=false
DOCUMENTS_SCAN_MODE=clamscan
DOCUMENTS_CLAMD_HOST=127.0.0.1
DOCUMENTS_CLAMD_PORT=3310
DOCUMENTS_CLAMSCAN_PATH=clamscan
DOCUMENTS_SCAN_TIMEOUT_MS=30000
DOCUMENTS_SCAN_FAIL_CLOSED=true

# server limits / timeouts
REQUEST_TIMEOUT_MS=60000
REQUEST_BODY_LIMIT_KB=200
GRACEFUL_SHUTDOWN_MS=15000
SERVER_HEADERS_TIMEOUT_MS=65000
SERVER_KEEPALIVE_TIMEOUT_MS=61000

# production safety
PROD_FAIL_FAST=true
PROD_REQUIRE_DOCS_PROTECT=true
PROD_REQUIRE_METRICS_PROTECT=true
PROD_DISALLOW_CORS_ALLOW_ALL=true

# ------------------------------------------------------------
# HTTPS nativo (opcional - si terminás TLS en Nginx/ALB, dejá en false)
# ------------------------------------------------------------
HTTPS_ENABLE=false
HTTPS_PORT=443
HTTPS_CERT_PATH=                       # /path/to/fullchain.pem
HTTPS_KEY_PATH=                        # /path/to/privkey.pem
HTTPS_CA_PATH=                         # /path/to/chain.pem (opcional)
HTTP_REDIRECT_PORT=80                  # 0 = deshabilitar redirect

# ------------------------------------------------------------
# Login Guard (bruteforce protection persistido en DB)
# Requiere tabla auth_login_guard (migración 001__auth_rbac_core.sql)
# ------------------------------------------------------------
LOGIN_GUARD_ENABLE=true
LOGIN_GUARD_MAX_ATTEMPTS=5
LOGIN_GUARD_LOCK_MINUTES=15

# ------------------------------------------------------------
# 2FA por email
# Requiere EMAIL_ENABLE=true y ENABLE_2FA=true para funcionar.
# Los usuarios con two_factor_enabled=1 en DB deben verificar código en /api/v1/auth/verify-2fa
# ------------------------------------------------------------
ENABLE_2FA=false
TWO_FA_CODE_TTL_MINUTES=10
TWO_FA_CODE_LENGTH=6

# ------------------------------------------------------------
# Email (SMTP) - requerido para 2FA y password reset
# Si EMAIL_ENABLE=false, los endpoints /forgot-password, /reset-password y /verify-2fa no se montan
# ------------------------------------------------------------
EMAIL_ENABLE=false
EMAIL_HOST=smtp.example.com
EMAIL_PORT=587
EMAIL_SECURE=false
EMAIL_USER=
EMAIL_PASSWORD=
EMAIL_FROM=noreply@example.com
PASSWORD_RESET_URL_BASE=https://tufrontend.com
