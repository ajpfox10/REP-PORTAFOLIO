apiVersion: 1

groups:
  - name: 'personalv5-alerts'
    interval: 30s
    rules:
      - alert: 'HighErrorRate'
        expr: 'sum(rate(http_requests_total{status=~"5.."}[5m])) / sum(rate(http_requests_total[5m])) > 0.05'
        for: 2m
        labels:
          severity: 'critical'
        annotations:
          summary: 'Error rate > 5% for 5 minutes'
          description: 'Current error rate: {{ $value }}'

      - alert: 'HighLatency'
        expr: 'histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le)) > 1'
        for: 5m
        labels:
          severity: 'warning'
        annotations:
          summary: 'P95 latency > 1s'
          description: 'Current P95: {{ $value }}s'

      - alert: 'RedisDown'
        expr: 'redis_up == 0'
        for: 1m
        labels:
          severity: 'critical'
        annotations:
          summary: 'Redis is down'

      - alert: 'MySQLDown'
        expr: 'mysql_up == 0'
        for: 1m
        labels:
          severity: 'critical'
        annotations:
          summary: 'MySQL is down'