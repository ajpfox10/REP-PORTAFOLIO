# ğŸ› ï¸ GuÃ­a ultra detallada paso a paso: CÃ³mo agregar un nuevo campo a un mÃ³dulo en el sistema RRHH

Esta guÃ­a estÃ¡ pensada para cualquier persona (incluso sin experiencia previa), y explica cÃ³mo agregar un nuevo campo a un mÃ³dulo en NestJS + Sequelize + Swagger, paso por paso y con ejemplos.

---

## âœ… Â¿QuÃ© significa "agregar un campo"?
Significa que queremos que una entidad (por ejemplo, un usuario) tenga un nuevo dato, como "telÃ©fono de emergencia", y que:

- Se guarde en la base de datos
- Se valide correctamente
- Aparezca en Swagger
- Sea usado desde los endpoints (POST, PATCH, etc.)

---

## ğŸ“¦ Â¿DÃ³nde tenemos que tocar?

| Parte               | Archivo                           | Â¿QuÃ© se hace?                                  |
|--------------------|------------------------------------|------------------------------------------------|
| ğŸ§  Modelo Sequelize | `usuario.model.ts`                | Se agrega el campo en la base de datos         |
| âœ… DTOs             | `usuario.dto.ts` y `actualizar-usuario.dto.ts` | Se valida el dato y se documenta Swagger |
| ğŸ“¡ Controller       | `usuario.controller.ts`            | Generalmente no hay que tocar si usÃ¡s DTOs     |
| ğŸ§© Servicio         | `usuario.service.ts`               | Solo si manejÃ¡s propiedades una por una        |
| ğŸ›¢ï¸ Base de datos    | Manual o automÃ¡tico (sync o ALTER) | Se crea el campo real en la tabla              |

---

## ğŸ¯ EJEMPLO REAL: Agregar el campo `telefonoEmergencia` al mÃ³dulo `usuario`

### 1ï¸âƒ£ Paso 1: Modificar el MODELO Sequelize

ğŸ“„ `src/database/models/usuario.model.ts`

BuscÃ¡ los campos del modelo y agregÃ¡:
```ts
@Column({ allowNull: true })
telefonoEmergencia?: string;
```

ğŸ“Œ Esto crea una propiedad en el modelo y la mapea con la base de datos.

âœ… Si no tenÃ©s `@Column` importado, agregalo:
```ts
import { Column } from 'sequelize-typescript';
```

---

### 2ï¸âƒ£ Paso 2: Modificar los DTOs (Create y Update)

#### ğŸ“„ Crear DTO: `usuario.dto.ts`

```ts
@ApiProperty({ example: '123456789', description: 'TelÃ©fono de emergencia del usuario' })
@IsString({ message: 'Debe ser un texto' })
@IsOptional()
telefonoEmergencia?: string;
```

#### ğŸ“„ Actualizar DTO: `actualizar-usuario.dto.ts`

RepetÃ­ exactamente lo mismo ğŸ‘† (los DTOs de update siempre tienen los mismos campos pero opcionales).

âœ… Â¿Por quÃ© usar `@IsOptional()`? Porque si no lo mandÃ¡s en la peticiÃ³n, no da error.

---

### 3ï¸âƒ£ Paso 3: Verificar el CONTROLLER

ğŸ“„ `usuario.controller.ts`

No tenÃ©s que hacer nada si usÃ¡s los DTOs correctamente en los mÃ©todos POST y PATCH:
```ts
@Post()
crear(@Body() dto: CreateUsuarioDto) { ... }

@Patch(':id')
actualizar(@Param('id', ParseIntPipe) id: number, @Body() dto: ActualizarUsuarioDto) { ... }
```

âœ… El DTO ya incluye el nuevo campo.

---

### 4ï¸âƒ£ Paso 4: Verificar el SERVICIO (Service)

ğŸ“„ `usuario.service.ts`

Si hacÃ©s algo como esto:
```ts
const usuario = await this.usuarioModel.create({ ...dto });
```
No tenÃ©s que hacer nada mÃ¡s âœ…

Pero si estÃ¡s creando los campos uno por uno:
```ts
usuario.telefonoEmergencia = dto.telefonoEmergencia;
```
ğŸ“Œ Asegurate de agregar la lÃ­nea para el nuevo campo.

---

### 5ï¸âƒ£ Paso 5: Modificar la BASE DE DATOS

âœ… Si estÃ¡s en desarrollo y usÃ¡s Sequelize con sincronizaciÃ³n automÃ¡tica (`sync: true`), el campo se crea al reiniciar el proyecto.

âš ï¸ Pero si estÃ¡s en producciÃ³n:
TenÃ©s que modificar la tabla manualmente (con migraciÃ³n o alter):

```sql
ALTER TABLE usuarios ADD COLUMN telefonoEmergencia VARCHAR(255);
```

âœ… Recomendado usar migraciones para mantener historial (si usÃ¡s `sequelize-cli` o `umzug`).

---

### 6ï¸âƒ£ Paso 6: Verificar que el campo aparece en Swagger

AbrÃ­ el navegador y entrÃ¡ en:
```
http://localhost:4000/api
```

BuscÃ¡ los endpoints POST y PATCH del mÃ³dulo `usuario`. 
âœ… DeberÃ­as ver `telefonoEmergencia` como un campo nuevo.

---

### 7ï¸âƒ£ Paso 7: Probar con Postman o cliente externo

ProbÃ¡ hacer una peticiÃ³n `POST /usuario` con este body:
```json
{
  "nombreUsuario": "Laura",
  "email": "laura@mail.com",
  "telefonoEmergencia": "1133445566"
}
```
âœ… Si no da error y se guarda, Â¡listo!

---

## ğŸ¯ Checklist para agregar un campo correctamente

- [x] Modelo actualizado con `@Column`
- [x] DTOs actualizados con validaciones y `@ApiProperty`
- [x] Servicio preparado para recibirlo (si es manual)
- [x] Base de datos modificada (sync o alter)
- [x] Swagger lo muestra
- [x] Probado con Postman

---

Con esta guÃ­a podÃ©s modificar cualquier entidad sin romper nada.

Â¿QuerÃ©s agregar una relaciÃ³n (belongsTo, hasMany, etc.)? Hay otra guÃ­a para eso ğŸ˜‰

